<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sourceforge.net/JSBSim.xsl"?>
<fdm_config name="QUAD COMPLETE EXT" version="2.0" release="BETA" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jsbsim.sourceforge.net/JSBSim.xsd">

  <fileheader>
    <author>Ziqing Ma</author>
    <filecreationdate>2022-05-16</filecreationdate>
    <version>Version 1</version>
    <description>Tilt_tailsitter</description>
  </fileheader>

  <metrics>
    <wingarea unit="IN2"> 110 </wingarea>
    <wingspan unit="IN"> 19.69 </wingspan>
    <chord unit="IN"> 5.5 </chord>
    <htailarea unit="FT2"> 0 </htailarea>
    <htailarm unit="FT"> 0 </htailarm>
    <vtailarea unit="FT2"> 0 </vtailarea>
    <vtailarm unit="FT"> 0 </vtailarm>
    <wing_incidence unit="DEG"> 90 </wing_incidence>
    <location name="AERORP" unit="IN">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
    <location name="EYEPOINT" unit="IN">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
    <location name="VRP" unit="IN">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
  </metrics>

  <mass_balance>
    <ixx unit="SLUG*FT2"> 0.00526 </ixx>
    <iyy unit="SLUG*FT2"> 0.00163 </iyy>
    <izz unit="SLUG*FT2"> 0.00364 </izz>
    <ixy unit="SLUG*FT2"> 0. </ixy>
    <ixz unit="SLUG*FT2"> 0. </ixz>
    <iyz unit="SLUG*FT2"> 0. </iyz>
        <emptywt unit="LBS"> 0.825 </emptywt>
    <location name="CG" unit="M">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
  </mass_balance>

  <ground_reactions>
    <contact type="STRUCTURE" name="CONTACT_FRONT">
      <location unit="M">
        <x>-0.15 </x>
        <y> 0 </y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_BACK">
      <location unit="M">
        <x> 0.15</x>
        <y> 0   </y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_RIGHT">
      <location unit="M">
        <x> 0.  </x>
        <y> 0.15</y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_LEFT">
      <location unit="M">
        <x> 0.  </x>
        <y>-0.15</y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>
  </ground_reactions>

  <flight_control name="actuator_dynamics">
    <channel name="filtering">

      <!--First order filter represents actuator dynamics-->
      <lag_filter name="tilt_left_lag">
        <input> fcs/tilt_left </input>
        <c1> 54 </c1>
        <output> fcs/tilt_left_lag</output>
      </lag_filter>
      <lag_filter name="tilt_right_lag">
        <input> fcs/tilt_right </input>
        <c1> 54 </c1>
        <output> fcs/tilt_right_lag</output>
      </lag_filter>
      <lag_filter name="mot_right_lag">
        <input> fcs/mot_right </input>
        <c1> 31.7 </c1>
        <output> fcs/mot_right_lag</output>
      </lag_filter>
      <lag_filter name="mot_left_lag">
        <input> fcs/mot_left </input>
        <c1> 31.7 </c1>
        <output> fcs/mot_left_lag</output>
      </lag_filter>
      <lag_filter name="ele_left_lag">
        <input> fcs/ele_left </input>
        <c1> 54 </c1>
        <output> fcs/ele_left_lag</output>
      </lag_filter>
      <lag_filter name="ele_right_lag">
        <input> fcs/ele_right </input>
        <c1> 54 </c1>
        <output> fcs/ele_right_lag</output>
      </lag_filter>
    </channel>
  </flight_control>

  <external_reactions>

    <property>fcs/tilt_left</property>
    <property>fcs/tilt_left_lag</property>
    <property>fcs/tilt_right</property>
    <property>fcs/tilt_right_lag</property>
    <property>fcs/mot_right</property>
    <property>fcs/mot_right_lag</property>
    <property>fcs/mot_left</property>
    <property>fcs/mot_left_lag</property>
    <property>fcs/ele_left</property>
    <property>fcs/ele_left_lag</property>
    <property>fcs/ele_right</property>
    <property>fcs/ele_right_lag</property>


    <!-- Left Motor -->

    <force name="mot_left_1" frame="BODY" unit="LBS">
      <function>
        <product>
         <product>
           <value> 0.224809 </value> <!-- N to LBS -->
            <!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
            <sum>
               <product>
                 <value> 4.5593 </value> <!-- k1 -->
                 <property>fcs/mot_left_lag</property>
                 <property>fcs/mot_left_lag</property>
               </product>
               <product>
                 <value> 2.7664 </value> <!-- k2 -->
                 <property>fcs/mot_left_lag</property>
               </product>
               <value> 0.1486 </value> <!-- k3 -->
            </sum>
            <!-- __________________________________________________________  -->
        </product>
        <sin>
	  <product>
		<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
		<property> fcs/tilt_left_lag </property>
	  </product>
	</sin>
       </product>
      </function>
      <location unit="IN">
        <x>0</x>
        <y>-6.3</y>
        <z>3</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="mot_left_2" frame="BODY" unit="LBS">
      <function>
        <product>
         <product>
           <value> 0.224809 </value> <!-- N to LBS -->
            <!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
            <sum>
               <product>
                 <value> 4.5593 </value> <!-- k1 -->
                 <property>fcs/mot_left_lag</property>
                 <property>fcs/mot_left_lag</property>
               </product>
               <product>
                 <value> 2.7664 </value> <!-- k2 -->
                 <property>fcs/mot_left_lag</property>
               </product>
               <value> 0.1486 </value> <!-- k3 -->
            </sum>
            <!-- __________________________________________________________  -->
        </product>
        <cos>
	  <product>
		<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
		<property> fcs/tilt_left_lag </property>
	  </product>
	</cos>
        </product>
      </function>
      <location unit="IN">
        <x>0</x>
        <y>-6.3</y>
        <z>3</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <!-- Right Motor -->

    <force name="mot_right_1" frame="BODY" unit="LBS">
      <function>
        <product>
         <product>
           <value> 0.224809 </value> <!-- N to LBS -->
            <!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
            <sum>
               <product>
                 <value> 4.5593 </value> <!-- k1 -->
                 <property>fcs/mot_right_lag</property>
                 <property>fcs/mot_right_lag</property>
               </product>
               <product>
                 <value> 2.7664 </value> <!-- k2 -->
                 <property>fcs/mot_right_lag</property>
               </product>
               <value> 0.1486 </value> <!-- k3 -->
            </sum>
            <!-- __________________________________________________________  -->
        </product>
        <sin>
	  <product>
		<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
		<property> fcs/tilt_right_lag </property>
	  </product>
	</sin>
        </product>
      </function>
      <location unit="IN">
        <x>0</x>
        <y>6.3</y>
        <z>3</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="mot_right_2" frame="BODY" unit="LBS">
      <function>
        <product>
         <product>
           <value> 0.224809 </value> <!-- N to LBS -->
            <!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
            <sum>
               <product>
                 <value> 4.5593 </value> <!-- k1 -->
                 <property>fcs/mot_right_lag</property>
                 <property>fcs/mot_right_lag</property>
               </product>
               <product>
                 <value> 2.7664 </value> <!-- k2 -->
                 <property>fcs/mot_right_lag</property>
               </product>
               <value> 0.1486 </value> <!-- k3 -->
            </sum>
            <!-- __________________________________________________________  -->
        </product>
        <cos>
	  <product>
		<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
		<property> fcs/tilt_right_lag </property>
	  </product>
	</cos>
        </product>
      </function>
      <location unit="IN">
        <x>0</x>
        <y>6.3</y>
        <z>3</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>


    <!--Yaw moments-->

  </external_reactions>

  <propulsion/>

  <flight_control name="FGFCS"/>

  <!--<aerodynamics>-->
    <!--<axis name="DRAG">-->
      <!--<function name="aero/coefficient/CD">-->
        <!--<description>Drag</description>-->
        <!--<product>-->
          <!--<property>aero/qbar-psf</property>-->
          <!--<value>47.9</value> [> Conversion to pascals <]-->
          <!--<value>0.0151</value> [> CD x Area (m^2) <]-->
          <!--<value>0.224808943</value> [> N to LBS <]-->
        <!--</product>-->
      <!--</function>-->
    <!--</axis>-->
  <!--</aerodynamics>-->
  <aerodynamics file="Systems/aerodynamics_tilt_tailsitter.xml"/>

</fdm_config>
